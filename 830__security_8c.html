<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>infix: t/830_security.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript"> DoxygenAwesomeDarkModeToggle.init() </script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript"> DoxygenAwesomeFragmentCopyButton.init() </script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript"> DoxygenAwesomeParagraphLink.init() </script>
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript"> DoxygenAwesomeInteractiveToc.init() </script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">infix
   </div>
   <div id="projectbrief">A JIT-Powered FFI Library for C</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('830__security_8c.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">830_security.c File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Unit test for security-hardening features of the <code>infix</code> library.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="double__tap_8h_source.html">common/double_tap.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="infix__internals_8h_source.html">common/infix_internals.h</a>&quot;</code><br />
<code>#include &lt;<a class="el" href="infix_8h_source.html">infix/infix.h</a>&gt;</code><br />
<code>#include &lt;limits.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;signal.h&gt;</code><br />
<code>#include &lt;sys/wait.h&gt;</code><br />
<code>#include &lt;unistd.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for 830_security.c:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="830__security_8c__incl.svg" width="100%" height="547"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a1655e4adfda95660042d34619eb61845" id="r_a1655e4adfda95660042d34619eb61845"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="830__security_8c.html#a1655e4adfda95660042d34619eb61845">DBLTAP_IMPLEMENTATION</a></td></tr>
<tr class="separator:a1655e4adfda95660042d34619eb61845"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a8fcb0b2df065db9dd72f731a65b7caa4" id="r_a8fcb0b2df065db9dd72f731a65b7caa4"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="830__security_8c.html#a8fcb0b2df065db9dd72f731a65b7caa4">dummy_target_func</a> (int a)</td></tr>
<tr class="separator:a8fcb0b2df065db9dd72f731a65b7caa4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a84ec4fb6b076f7d0d2c769feb2d20a47" id="r_a84ec4fb6b076f7d0d2c769feb2d20a47"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="830__security_8c.html#a84ec4fb6b076f7d0d2c769feb2d20a47">dummy_handler_func</a> (void)</td></tr>
<tr class="separator:a84ec4fb6b076f7d0d2c769feb2d20a47"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a665a4f875933c999015be28858bc501d" id="r_a665a4f875933c999015be28858bc501d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="830__security_8c.html#a665a4f875933c999015be28858bc501d">subtest</a> (&quot;Guard pages prevent use-after-free&quot;)</td></tr>
<tr class="separator:a665a4f875933c999015be28858bc501d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1d1f2ad83cdf46fa4c0828ebe2a44dd9" id="r_a1d1f2ad83cdf46fa4c0828ebe2a44dd9"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="830__security_8c.html#a1d1f2ad83cdf46fa4c0828ebe2a44dd9">subtest</a> (&quot;Writing to a hardened reverse trampoline context causes a crash&quot;)</td></tr>
<tr class="separator:a1d1f2ad83cdf46fa4c0828ebe2a44dd9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0f5fd0a36885ca12b62409c20680cd8f" id="r_a0f5fd0a36885ca12b62409c20680cd8f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="830__security_8c.html#a0f5fd0a36885ca12b62409c20680cd8f">subtest</a> (&quot;API hardening against integer overflows&quot;)</td></tr>
<tr class="separator:a0f5fd0a36885ca12b62409c20680cd8f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa02a11c2db3bee657a4503e2a199554d" id="r_aa02a11c2db3bee657a4503e2a199554d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="830__security_8c.html#aa02a11c2db3bee657a4503e2a199554d">subtest</a> (&quot;POSIX hardened allocator (shm_open)&quot;)</td></tr>
<tr class="separator:aa02a11c2db3bee657a4503e2a199554d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a67c1cbb549407d754fe1894f74b40c3e" id="r_a67c1cbb549407d754fe1894f74b40c3e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="830__security_8c.html#a67c1cbb549407d754fe1894f74b40c3e">TEST</a></td></tr>
<tr class="separator:a67c1cbb549407d754fe1894f74b40c3e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Unit test for security-hardening features of the <code>infix</code> library. </p>
<p>This test file verifies several critical security mechanisms designed to make the library resilient against common memory corruption vulnerabilities. Since these tests involve intentionally triggering crashes, they are executed in child processes to avoid terminating the main test runner.</p>
<p>The test covers:</p>
<ol type="1">
<li><b>Use-After-Free (UAF) Prevention:</b><ul>
<li>It creates a trampoline (forward bound, forward unbound, and reverse), destroys it, and then attempts to call the dangling function pointer.</li>
<li>It verifies that this action results in an immediate and controlled crash (e.g., a <code>SIGSEGV</code>), proving that the "guard page" mechanism in <code>infix_executable_free</code> is working correctly.</li>
</ul>
</li>
<li><b>Context Memory Hardening:</b><ul>
<li>It creates a reverse trampoline, whose context struct is allocated in a special memory region.</li>
<li>After creation, the JIT engine makes this memory region read-only.</li>
<li>The test then attempts to write to a field within this context (<code>rt-&gt;user_data</code>).</li>
<li>It verifies that this write attempt causes a crash, proving that the context is successfully protected from runtime memory corruption.</li>
</ul>
</li>
<li><b>API Hardening against Integer Overflows:</b><ul>
<li>It calls <code>infix_type_create_*</code> functions with maliciously crafted inputs designed to cause integer overflows during size and layout calculations (e.g., creating an array with <code>SIZE_MAX</code> elements).</li>
<li>It verifies that the API functions detect these overflows, return an error status (<code>INFIX_ERROR_INVALID_ARGUMENT</code>), and do not proceed with a potentially dangerous allocation. </li>
</ul>
</li>
</ol>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a1655e4adfda95660042d34619eb61845" name="a1655e4adfda95660042d34619eb61845"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1655e4adfda95660042d34619eb61845">&#9670;&#160;</a></span>DBLTAP_IMPLEMENTATION</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DBLTAP_IMPLEMENTATION</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a84ec4fb6b076f7d0d2c769feb2d20a47" name="a84ec4fb6b076f7d0d2c769feb2d20a47"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a84ec4fb6b076f7d0d2c769feb2d20a47">&#9670;&#160;</a></span>dummy_handler_func()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dummy_handler_func </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a8fcb0b2df065db9dd72f731a65b7caa4" name="a8fcb0b2df065db9dd72f731a65b7caa4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8fcb0b2df065db9dd72f731a65b7caa4">&#9670;&#160;</a></span>dummy_target_func()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dummy_target_func </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>a</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a0f5fd0a36885ca12b62409c20680cd8f" name="a0f5fd0a36885ca12b62409c20680cd8f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0f5fd0a36885ca12b62409c20680cd8f">&#9670;&#160;</a></span>subtest() <span class="overload">[1/4]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subtest </td>
          <td>(</td>
          <td class="paramtype">&quot;API hardening against integer overflows&quot;&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a665a4f875933c999015be28858bc501d" name="a665a4f875933c999015be28858bc501d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a665a4f875933c999015be28858bc501d">&#9670;&#160;</a></span>subtest() <span class="overload">[2/4]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subtest </td>
          <td>(</td>
          <td class="paramtype">&quot;Guard pages prevent use-after-free&quot;&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="aa02a11c2db3bee657a4503e2a199554d" name="aa02a11c2db3bee657a4503e2a199554d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa02a11c2db3bee657a4503e2a199554d">&#9670;&#160;</a></span>subtest() <span class="overload">[3/4]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subtest </td>
          <td>(</td>
          <td class="paramtype">&quot;POSIX hardened allocator (shm_open)&quot;&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a1d1f2ad83cdf46fa4c0828ebe2a44dd9" name="a1d1f2ad83cdf46fa4c0828ebe2a44dd9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1d1f2ad83cdf46fa4c0828ebe2a44dd9">&#9670;&#160;</a></span>subtest() <span class="overload">[4/4]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subtest </td>
          <td>(</td>
          <td class="paramtype">&quot;Writing to a hardened reverse trampoline context causes a crash&quot;&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a67c1cbb549407d754fe1894f74b40c3e" name="a67c1cbb549407d754fe1894f74b40c3e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a67c1cbb549407d754fe1894f74b40c3e">&#9670;&#160;</a></span>TEST</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TEST</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_75a01b229474ab4722425a88156bb54e.html">t</a></li><li class="navelem"><a class="el" href="830__security_8c.html">830_security.c</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
