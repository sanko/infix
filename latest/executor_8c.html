<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>infix FFI Library: src/core/executor.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">infix FFI Library<span id="projectnumber">&#160;0.1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_aebb8dcc11953d78e620bbef0b9e2183.html">core</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">executor.c File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Implements the OS-level memory management and the internal callback dispatcher.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;../common/infix_internals.h&quot;</code><br />
<code>#include &quot;<a class="el" href="utility_8h_source.html">../common/utility.h</a>&quot;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;time.h&gt;</code><br />
<code>#include &lt;errno.h&gt;</code><br />
<code>#include &lt;fcntl.h&gt;</code><br />
<code>#include &lt;sys/mman.h&gt;</code><br />
<code>#include &lt;sys/types.h&gt;</code><br />
<code>#include &lt;unistd.h&gt;</code><br />
<code>#include &lt;stdint.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for executor.c:</div>
<div class="dyncontent">
<div class="center"><img src="executor_8c__incl.png" border="0" usemap="#asrc_2core_2executor_8c" alt=""/></div>
<map name="asrc_2core_2executor_8c" id="asrc_2core_2executor_8c">
<area shape="rect" title="Implements the OS&#45;level memory management and the internal callback dispatcher." alt="" coords="558,5,701,31"/>
<area shape="rect" href="infix__internals_8h_source.html" title=" " alt="" coords="90,79,289,104"/>
<area shape="poly" title=" " alt="" coords="559,33,274,79,273,74,558,28"/>
<area shape="rect" title=" " alt="" coords="25,225,96,251"/>
<area shape="poly" title=" " alt="" coords="558,24,440,28,300,39,170,56,117,67,79,81,54,95,36,109,23,127,11,153,9,169,14,185,37,214,32,218,9,188,3,170,6,151,18,124,32,105,51,90,77,76,116,62,169,50,300,33,440,23,558,18"/>
<area shape="rect" href="utility_8h.html" title="A header for debugging utilities that are conditionally compiled." alt="" coords="333,152,476,177"/>
<area shape="poly" title=" " alt="" coords="558,27,499,34,437,45,385,60,366,70,353,80,348,95,352,111,364,127,379,141,375,145,360,130,348,113,342,95,349,77,363,65,383,55,436,40,498,29,558,22"/>
<area shape="rect" title=" " alt="" coords="363,79,430,104"/>
<area shape="poly" title=" " alt="" coords="593,33,444,78,442,73,591,28"/>
<area shape="rect" title=" " alt="" coords="454,79,525,104"/>
<area shape="poly" title=" " alt="" coords="608,33,526,75,523,70,606,28"/>
<area shape="rect" title=" " alt="" coords="549,79,620,104"/>
<area shape="poly" title=" " alt="" coords="624,32,601,69,597,66,620,30"/>
<area shape="rect" title=" " alt="" coords="644,79,708,104"/>
<area shape="poly" title=" " alt="" coords="640,30,663,66,659,69,635,32"/>
<area shape="rect" title=" " alt="" coords="733,79,801,104"/>
<area shape="poly" title=" " alt="" coords="653,28,734,70,731,75,650,33"/>
<area shape="rect" title=" " alt="" coords="825,79,888,104"/>
<area shape="poly" title=" " alt="" coords="667,28,812,74,811,79,665,33"/>
<area shape="rect" title=" " alt="" coords="912,79,1014,104"/>
<area shape="poly" title=" " alt="" coords="684,28,898,74,897,79,683,33"/>
<area shape="rect" title=" " alt="" coords="1039,79,1135,104"/>
<area shape="poly" title=" " alt="" coords="702,27,1026,76,1025,81,701,32"/>
<area shape="rect" title=" " alt="" coords="1159,79,1234,104"/>
<area shape="poly" title=" " alt="" coords="701,22,898,42,1146,76,1145,81,897,47,701,28"/>
<area shape="rect" href="infix__config_8h.html" title="Internal&#45;only header for platform, architecture, and ABI detection." alt="" coords="21,152,190,177"/>
<area shape="poly" title=" " alt="" coords="178,106,132,145,128,141,174,102"/>
<area shape="rect" href="infix_8h.html" title="The main public header for the infix FFI library." alt="" coords="214,152,309,177"/>
<area shape="poly" title=" " alt="" coords="203,102,242,140,238,144,200,106"/>
<area shape="rect" title=" " alt="" coords="207,299,290,324"/>
<area shape="poly" title=" " alt="" coords="259,178,246,226,244,256,247,285,241,285,239,256,240,225,254,177"/>
<area shape="rect" title=" " alt="" coords="350,299,424,324"/>
<area shape="poly" title=" " alt="" coords="265,177,272,212,280,231,290,249,316,273,346,291,343,295,313,277,286,252,275,234,267,213,260,178"/>
<area shape="poly" title=" " alt="" coords="230,180,107,223,105,218,228,175"/>
<area shape="rect" href="compat__c23_8h.html" title="Provides compatibility shims for C23 features in a C17/C11 project." alt="" coords="300,225,474,251"/>
<area shape="poly" title=" " alt="" coords="283,175,356,216,353,221,280,180"/>
<area shape="poly" title=" " alt="" coords="366,253,284,295,282,290,363,248"/>
<area shape="poly" title=" " alt="" coords="390,251,390,285,384,285,384,251"/>
<area shape="poly" title=" " alt="" coords="432,175,456,189,479,206,492,227,493,240,489,252,466,278,438,295,435,291,463,274,485,249,488,239,487,229,475,210,453,193,429,180"/>
<area shape="poly" title=" " alt="" coords="404,178,396,213,390,212,399,177"/>
</map>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="executor_8c__dep__incl.png" border="0" usemap="#asrc_2core_2executor_8cdep" alt=""/></div>
<map name="asrc_2core_2executor_8cdep" id="asrc_2core_2executor_8cdep">
<area shape="rect" title="Implements the OS&#45;level memory management and the internal callback dispatcher." alt="" coords="5,5,148,31"/>
<area shape="rect" href="infix_8c.html" title="The unity build source file for the infix library." alt="" coords="35,79,119,104"/>
<area shape="poly" title=" " alt="" coords="79,44,79,79,74,79,74,44"/>
</map>
</div>
</div>
<p><a href="executor_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a721f1c9cffdcefd87ca6cf40b0d99adc" id="r_a721f1c9cffdcefd87ca6cf40b0d99adc"><td class="memItemLeft" align="right" valign="top"><a class="el" href="compat__c23_8h.html#a17f672198fb63e31ca0dba6aea752863">c23_nodiscard</a> <a class="el" href="structinfix__executable__t.html">infix_executable_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="executor_8c.html#a721f1c9cffdcefd87ca6cf40b0d99adc">infix_executable_alloc</a> (size_t size)</td></tr>
<tr class="memdesc:a721f1c9cffdcefd87ca6cf40b0d99adc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocates a block of memory suitable for JIT compilation.  <br /></td></tr>
<tr class="separator:a721f1c9cffdcefd87ca6cf40b0d99adc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2dc6a62860160637126cf984b77a2d46" id="r_a2dc6a62860160637126cf984b77a2d46"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="executor_8c.html#a2dc6a62860160637126cf984b77a2d46">infix_executable_free</a> (<a class="el" href="structinfix__executable__t.html">infix_executable_t</a> exec)</td></tr>
<tr class="memdesc:a2dc6a62860160637126cf984b77a2d46"><td class="mdescLeft">&#160;</td><td class="mdescRight">Frees a block of executable memory, turning it into a guard page first.  <br /></td></tr>
<tr class="separator:a2dc6a62860160637126cf984b77a2d46"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a28b554e0d17b214853dca915ecc1afc1" id="r_a28b554e0d17b214853dca915ecc1afc1"><td class="memItemLeft" align="right" valign="top"><a class="el" href="compat__c23_8h.html#a17f672198fb63e31ca0dba6aea752863">c23_nodiscard</a> bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="executor_8c.html#a28b554e0d17b214853dca915ecc1afc1">infix_executable_make_executable</a> (<a class="el" href="structinfix__executable__t.html">infix_executable_t</a> exec)</td></tr>
<tr class="memdesc:a28b554e0d17b214853dca915ecc1afc1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Makes a memory block executable and finalizes it for use.  <br /></td></tr>
<tr class="separator:a28b554e0d17b214853dca915ecc1afc1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6661b906602a04bbd15a91ecc1c6adde" id="r_a6661b906602a04bbd15a91ecc1c6adde"><td class="memItemLeft" align="right" valign="top"><a class="el" href="compat__c23_8h.html#a17f672198fb63e31ca0dba6aea752863">c23_nodiscard</a> <a class="el" href="structinfix__protected__t.html">infix_protected_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="executor_8c.html#a6661b906602a04bbd15a91ecc1c6adde">infix_protected_alloc</a> (size_t size)</td></tr>
<tr class="memdesc:a6661b906602a04bbd15a91ecc1c6adde"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocates a page-aligned block of read-write data memory.  <br /></td></tr>
<tr class="separator:a6661b906602a04bbd15a91ecc1c6adde"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1cf96474020e05e7a98b191a61fd7fbf" id="r_a1cf96474020e05e7a98b191a61fd7fbf"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="executor_8c.html#a1cf96474020e05e7a98b191a61fd7fbf">infix_protected_free</a> (<a class="el" href="structinfix__protected__t.html">infix_protected_t</a> prot)</td></tr>
<tr class="memdesc:a1cf96474020e05e7a98b191a61fd7fbf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Frees a block of protected data memory.  <br /></td></tr>
<tr class="separator:a1cf96474020e05e7a98b191a61fd7fbf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9b41b11f951e09fb9ea8b609c312ac95" id="r_a9b41b11f951e09fb9ea8b609c312ac95"><td class="memItemLeft" align="right" valign="top"><a class="el" href="compat__c23_8h.html#a17f672198fb63e31ca0dba6aea752863">c23_nodiscard</a> bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="executor_8c.html#a9b41b11f951e09fb9ea8b609c312ac95">infix_protected_make_readonly</a> (<a class="el" href="structinfix__protected__t.html">infix_protected_t</a> prot)</td></tr>
<tr class="memdesc:a9b41b11f951e09fb9ea8b609c312ac95"><td class="mdescLeft">&#160;</td><td class="mdescRight">Changes the permissions of a protected data block from Read/Write to Read-Only.  <br /></td></tr>
<tr class="separator:a9b41b11f951e09fb9ea8b609c312ac95"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab973839755f4384eb456335fcb87cdc2" id="r_ab973839755f4384eb456335fcb87cdc2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="executor_8c.html#ab973839755f4384eb456335fcb87cdc2">infix_internal_dispatch_callback_fn_impl</a> (<a class="el" href="structinfix__reverse__t.html">infix_reverse_t</a> *context, void *return_value_ptr, void **args_array)</td></tr>
<tr class="memdesc:ab973839755f4384eb456335fcb87cdc2"><td class="mdescLeft">&#160;</td><td class="mdescRight">The internal C dispatcher function for all reverse trampolines (cached).  <br /></td></tr>
<tr class="separator:ab973839755f4384eb456335fcb87cdc2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Implements the OS-level memory management and the internal callback dispatcher. </p>
<p>Copyright (c) 2025 Sanko Robinson</p>
<p>This source code is dual-licensed under the Artistic License 2.0 or the MIT License. You may choose to use this code under the terms of either license.</p>
<p>SPDX-License-Identifier: (Artistic-2.0 OR MIT)</p>
<p>The documentation blocks within this file are licensed under the Creative Commons Attribution 4.0 International License (CC BY 4.0).</p>
<p>SPDX-License-Identifier: CC-BY-4.0</p>
<p>This file forms the OS abstraction layer for the FFI library. It is responsible for two primary, security-critical tasks:</p>
<ol type="1">
<li><b>Executable Memory Management:</b> It provides a cross-platform interface for allocating, freeing, and managing executable memory. This implementation adheres to a strict W^X (Write XOR Execute) security policy, meaning memory is never writable and executable at the same time. This is a crucial defense against JIT-spraying and other code injection attacks. Different OSes require different strategies to achieve this:<ul>
<li><b>On Windows:</b> It uses the native <code>VirtualAlloc</code> API for single-region allocation.</li>
<li><b>On macOS &amp; others:</b> It uses a simple and reliable single-region <code>mmap</code>, which is known to work correctly and avoid platform-specific JIT issues.</li>
<li><b>On other POSIX systems (Linux, BSD):</b> It uses a dual-mapping technique with an anonymous shared memory object (<code>shm_open</code>) to create separate writable and executable views of the same physical memory, which is necessary for some hardened systems.</li>
</ul>
</li>
<li><b>Callback Dispatching:</b> It contains the high-level C function (<code>infix_internal_dispatch_callback_fn_impl</code>) that is called by the low-level assembly of a reverse trampoline. This function acts as the final bridge to invoke the user's C callback with the correctly marshalled arguments. </li>
</ol>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a721f1c9cffdcefd87ca6cf40b0d99adc" name="a721f1c9cffdcefd87ca6cf40b0d99adc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a721f1c9cffdcefd87ca6cf40b0d99adc">&#9670;&#160;</a></span>infix_executable_alloc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="compat__c23_8h.html#a17f672198fb63e31ca0dba6aea752863">c23_nodiscard</a> <a class="el" href="structinfix__executable__t.html">infix_executable_t</a> infix_executable_alloc </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Allocates a block of memory suitable for JIT compilation. </p>
<p>Allocates a block of page-aligned memory suitable for JIT code.</p>
<p>This function is a cross-platform wrapper that allocates memory with initial Read/Write permissions. The final memory block is guaranteed to be page-aligned, as required by memory protection APIs.</p>
<p>It employs different strategies based on the operating system to achieve W^X:</p><ul>
<li><b>Windows:</b> Uses <code>VirtualAlloc</code> to reserve and commit a single region of memory. The pointer is initially RW and later changed to RX.</li>
<li><b>macOS, OpenBSD &amp; Termux:</b> Uses a simple <code>mmap</code> with <code>MAP_PRIVATE | MAP_ANON</code>. This single-mapping approach is reliable and avoids <code>SIGBUS</code> errors and other complications common with more complex JIT setups on these platforms.</li>
<li><b>Linux &amp; other POSIX:</b> Uses a <b>dual-mapping</b> technique. It creates an anonymous shared memory object (<code>shm_open</code>) and then creates two separate virtual memory mappings to it: one that is <code>PROT_READ | PROT_WRITE</code> (<code>rw_ptr</code>) and another that is <code>PROT_READ | PROT_EXEC</code> (<code>rx_ptr</code>). This ensures memory is never writable and executable at the same time from different virtual addresses, satisfying strict security policies found on some hardened systems.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">size</td><td>The number of bytes to allocate. Will be rounded up to the nearest page size. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>An <code><a class="el" href="structinfix__executable__t.html">infix_executable_t</a></code> handle. On failure, the <code>size</code> member of the returned struct will be 0. </dd></dl>

</div>
</div>
<a id="a2dc6a62860160637126cf984b77a2d46" name="a2dc6a62860160637126cf984b77a2d46"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2dc6a62860160637126cf984b77a2d46">&#9670;&#160;</a></span>infix_executable_free()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void infix_executable_free </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structinfix__executable__t.html">infix_executable_t</a>&#160;</td>
          <td class="paramname"><em>exec</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Frees a block of executable memory, turning it into a guard page first. </p>
<p>Frees a block of executable memory.</p>
<p>This function first changes the memory's protection to be inaccessible (<code>PAGE_NOACCESS</code> or <code>PROT_NONE</code>), turning it into a "guard page". Any attempt to execute a dangling function pointer that points to this memory will cause an immediate and safe access violation, rather than executing stale or unrelated data. After arming the guard, it then releases the underlying memory resources.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">exec</td><td>The <code><a class="el" href="structinfix__executable__t.html">infix_executable_t</a></code> handle to the memory to be freed. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a28b554e0d17b214853dca915ecc1afc1" name="a28b554e0d17b214853dca915ecc1afc1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a28b554e0d17b214853dca915ecc1afc1">&#9670;&#160;</a></span>infix_executable_make_executable()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="compat__c23_8h.html#a17f672198fb63e31ca0dba6aea752863">c23_nodiscard</a> bool infix_executable_make_executable </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structinfix__executable__t.html">infix_executable_t</a>&#160;</td>
          <td class="paramname"><em>exec</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Makes a memory block executable and finalizes it for use. </p>
<p>Makes a memory block executable and read-only.</p>
<p>This is the final step in the JIT process. After machine code has been written to the <code>rw_ptr</code> of an <code><a class="el" href="structinfix__executable__t.html">infix_executable_t</a></code> handle, this function makes the <code>rx_ptr</code> executable.</p>
<p>Platform-specific actions:</p><ul>
<li><b>ARM64 (All OSes):</b> It first performs an instruction cache flush (<code>__builtin___clear_cache</code> or <code>FlushInstructionCache</code>). This is critical on architectures with separate data and instruction caches to ensure the CPU sees the newly written code bytes.</li>
<li><b>Windows/macOS/OpenBSD (Single-Map):</b> It then changes the memory protection of the single memory region from <code>Read/Write</code> to <code>Read/Execute</code> using <code>VirtualProtect</code> or <code>mprotect</code>, thereby enforcing W^X.</li>
<li><b>Linux/BSD (Dual-Map):</b> No <code>mprotect</code> call is needed because the <code>rx_ptr</code> is a separate mapping that was already created with <code>PROT_EXEC</code>. The function's only job on these platforms is to perform the necessary cache flush on ARM.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">exec</td><td>The <code><a class="el" href="structinfix__executable__t.html">infix_executable_t</a></code> handle to the memory block. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><code>true</code> on success, <code>false</code> on failure (e.g., if <code>mprotect</code> fails). </dd></dl>

</div>
</div>
<a id="ab973839755f4384eb456335fcb87cdc2" name="ab973839755f4384eb456335fcb87cdc2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab973839755f4384eb456335fcb87cdc2">&#9670;&#160;</a></span>infix_internal_dispatch_callback_fn_impl()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void infix_internal_dispatch_callback_fn_impl </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structinfix__reverse__t.html">infix_reverse_t</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>return_value_ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void **&#160;</td>
          <td class="paramname"><em>args_array</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The internal C dispatcher function for all reverse trampolines (cached). </p>
<p>This function is the high-level C bridge called by the low-level assembly of a reverse trampoline. It receives arguments in a normalized format (an array of <code>void*</code>) and is responsible for invoking the user's actual C callback handler.</p>
<p>The process is as follows:</p><ol type="1">
<li>It receives the <code><a class="el" href="structinfix__reverse__t.html">infix_reverse_t</a></code> context and the <code>args_array</code> from the JIT-compiled assembly stub.</li>
<li>It constructs a <b>new, augmented argument array</b> on the stack.</li>
<li>The <b>first element</b> of this new array is set to a pointer to the <code>context</code>.</li>
<li>The pointers from the original <code>args_array</code> are copied into the rest of the new array.</li>
<li>It retrieves the <code>cached_forward_trampoline</code> from the context (which was generated to expect this augmented argument list).</li>
<li>It calls the user's C handler through this trampoline, transparently passing the context as the first argument.</li>
</ol>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">context</td><td>A pointer to the callback's context structure. </td></tr>
    <tr><td class="paramname">return_value_ptr</td><td>A pointer to a buffer on the trampoline's stack where the return value should be stored. </td></tr>
    <tr><td class="paramname">args_array</td><td>An array of pointers from the JIT stub, where each element points to an argument's data from the native caller. </td></tr>
  </table>
  </dd>
</dl>
<p>For all other function signatures, use the cached forward trampoline</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="executor_8c_ab973839755f4384eb456335fcb87cdc2_cgraph.png" border="0" usemap="#aexecutor_8c_ab973839755f4384eb456335fcb87cdc2_cgraph" alt=""/></div>
<map name="aexecutor_8c_ab973839755f4384eb456335fcb87cdc2_cgraph" id="aexecutor_8c_ab973839755f4384eb456335fcb87cdc2_cgraph">
<area shape="rect" title="The internal C dispatcher function for all reverse trampolines (cached)." alt="" coords="5,5,175,45"/>
<area shape="rect" href="group__high__level__api.html#ga7b043799f03cb7e6d223991828b27822" title="Retrieves the executable code pointer from a forward trampoline." alt="" coords="223,13,396,38"/>
<area shape="poly" title=" " alt="" coords="175,23,209,23,209,28,175,28"/>
</map>
</div>

</div>
</div>
<a id="a6661b906602a04bbd15a91ecc1c6adde" name="a6661b906602a04bbd15a91ecc1c6adde"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6661b906602a04bbd15a91ecc1c6adde">&#9670;&#160;</a></span>infix_protected_alloc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="compat__c23_8h.html#a17f672198fb63e31ca0dba6aea752863">c23_nodiscard</a> <a class="el" href="structinfix__protected__t.html">infix_protected_t</a> infix_protected_alloc </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Allocates a page-aligned block of read-write data memory. </p>
<p>Allocates a block of page-aligned read-write data memory. </p>

</div>
</div>
<a id="a1cf96474020e05e7a98b191a61fd7fbf" name="a1cf96474020e05e7a98b191a61fd7fbf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1cf96474020e05e7a98b191a61fd7fbf">&#9670;&#160;</a></span>infix_protected_free()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void infix_protected_free </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structinfix__protected__t.html">infix_protected_t</a>&#160;</td>
          <td class="paramname"><em>prot</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Frees a block of protected data memory. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">prot</td><td>The memory handle to free. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a9b41b11f951e09fb9ea8b609c312ac95" name="a9b41b11f951e09fb9ea8b609c312ac95"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9b41b11f951e09fb9ea8b609c312ac95">&#9670;&#160;</a></span>infix_protected_make_readonly()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="compat__c23_8h.html#a17f672198fb63e31ca0dba6aea752863">c23_nodiscard</a> bool infix_protected_make_readonly </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structinfix__protected__t.html">infix_protected_t</a>&#160;</td>
          <td class="paramname"><em>prot</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Changes the permissions of a protected data block from Read/Write to Read-Only. </p>
<p>Changes a protected data block to be read-only. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
