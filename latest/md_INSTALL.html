<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>infix FFI Library: Building and Integrating &lt;tt&gt;infix&lt;/tt&gt;</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">infix FFI Library<span id="projectnumber">&#160;0.1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Building and Integrating &lt;tt&gt;infix&lt;/tt&gt;</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md188"></a> This guide provides detailed instructions for building the <code>infix</code> library from source and integrating it into your own projects. <code>infix</code> is designed to be easy to compile and supports several popular build systems.</p>
<h1><a class="anchor" id="autotoc_md189"></a>
Prerequisites</h1>
<p>To build <code>infix</code>, you will need:</p>
<ul>
<li>A <b>C17-compatible compiler</b>, such as:<ul>
<li>GCC (version 8 or newer)</li>
<li>Clang (version 7 or newer)</li>
<li>Microsoft Visual C++ (Visual Studio 2019 or newer)</li>
</ul>
</li>
<li>One of the following <b>build systems</b> (optional, but recommended):<ul>
<li><a href="https://cmake.org/download/">CMake</a> (version 3.12 or newer)</li>
<li><a href="https://xmake.io/#/guide/installation">xmake</a></li>
<li>GNU Make (for Linux/macOS) or NMake (for Windows)</li>
<li>Perl v5.40+ (includes support for the fuzzers and other advanced developer stuff)</li>
</ul>
</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md191"></a>
1. Building &lt;tt&gt;infix&lt;/tt&gt; from Source</h1>
<p>Choose the build system that best fits your environment.</p>
<h2><a class="anchor" id="autotoc_md192"></a>
Using xmake (Recommended)</h2>
<p>xmake is the recommended build system for most platforms as it provides a simple, cross-platform build experience.</p>
<ol type="1">
<li><p class="startli"><b>Build:</b></p>
<p class="startli"><code>bash xmake </code></p>
</li>
<li><p class="startli"><b>Run Tests:</b></p>
<p class="startli"><code>bash xmake test </code></p>
</li>
</ol>
<p>Now, you can simply include the header (<code>#include &lt;<a class="el" href="infix_8h.html" title="The main public header for the infix FFI library.">infix.h</a>&gt;</code>) in your source files and build your project with <code>xmake</code>.</p>
<h2><a class="anchor" id="autotoc_md193"></a>
Using Perl</h2>
<p>This is what I use to develop <code>infix</code> itself but it might be great for just building the lib without installing cmake or xmake. Perl is everywhere!*</p>
<div class="fragment"><div class="line"># Run the advanced perl based builder</div>
<div class="line">perl build.pl help</div>
<div class="line"> </div>
<div class="line"># Build and run valgrind tests</div>
<div class="line">perl build.pl --verbose memtest:fault</div>
<div class="line"> </div>
<div class="line"># Build infix for another ABI than the current machine&#39;s</div>
<div class="line"># Great for fuzzing</div>
<div class="line">perl build.pl --abi=sysv_x64 build</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md194"></a>
Using CMake</h2>
<p>CMake can generate native build files for your environment (e.g., Makefiles on Linux, Visual Studio solutions on Windows).</p>
<p><b>Standard Build &amp; Install:</b></p>
<ol type="1">
<li><p class="startli"><b>Configure:</b> From the root of the <code>infix</code> project, run CMake to generate the build files in a <code>build</code> directory.</p>
<p class="startli"><code>bash @section autotoc_md195 Creates a 'build' directory and prepares it for compilation cmake -B build </code></p>
</li>
<li><p class="startli"><b>Build:</b> Compile the library using the generated files.</p>
<p class="startli"><code>bash @section autotoc_md196 Compiles libinfix.a (or infix.lib on Windows) inside the 'build' directory cmake --build build </code></p>
</li>
<li><p class="startli"><b>Test:</b> Run the compiled unit tests.</p>
<div class="fragment"><div class="line"># Verify</div>
<div class="line">ctest --test-dir build</div>
</div><!-- fragment --></li>
<li><p class="startli"><b>Install:</b> Install the library and headers to the location specified by <code>CMAKE_INSTALL_PREFIX</code>.</p>
<p class="startli"><code>bash @section autotoc_md197 Installs headers to /usr/local/include, library to /usr/local/lib, etc. @section autotoc_md198 On Linux/macOS, you may need sudo. cmake --install build </code></p>
</li>
</ol>
<p><b>Custom Install Location:</b></p>
<p>To install <code>infix</code> to a custom directory (e.g., inside your project), use the <code>CMAKE_INSTALL_PREFIX</code> option during the configure step.</p>
<div class="fragment"><div class="line"># Configure to install into a &#39;local_install&#39; directory within the project</div>
<div class="line">cmake -B build -DCMAKE_INSTALL_PREFIX=./local_install</div>
<div class="line"> </div>
<div class="line"># Build and install as before</div>
<div class="line">cmake --build build</div>
<div class="line">cmake --install build</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md199"></a>
Using Makefiles</h3>
<h4><a class="anchor" id="autotoc_md200"></a>
GNU Make (Linux, macOS, BSDs)</h4>
<p>A standard Makefile is provided for POSIX-like systems.</p>
<ol type="1">
<li><p class="startli"><b>Build:</b></p>
<p class="startli"><code>bash make </code></p>
</li>
<li><p class="startli"><b>Run Tests:</b></p>
<p class="startli"><code>bash make test </code></p>
</li>
<li><p class="startli"><b>Install:</b></p>
<p class="startli"><code>bash @section autotoc_md201 This usually requires root privileges sudo make install </code></p>
</li>
</ol>
<h4><a class="anchor" id="autotoc_md202"></a>
NMake (Windows with MSVC)</h4>
<p>If you are using Microsoft Visual C++, open a <b>Developer Command Prompt for VS</b> and use <code>nmake</code>.</p>
<ol type="1">
<li><p class="startli"><b>Build:</b></p>
<p class="startli"><code>bash nmake /f Makefile.win </code></p>
</li>
</ol>
<h3><a class="anchor" id="autotoc_md203"></a>
Manual Compilation (Advanced)</h3>
<p>Since <code>infix</code> uses a unity build, you can compile it into a static library with a single command. This is useful for minimal environments or for embedding directly into another build system.</p>
<p><b>On Linux/macOS (GCC/Clang):</b></p>
<div class="fragment"><div class="line"># 1. Compile the unity build source file into an object file</div>
<div class="line">gcc -c -std=c17 -Iinclude -o infix.o src/infix.c</div>
<div class="line"> </div>
<div class="line"># 2. Archive the object file into a static library</div>
<div class="line">ar rcs libinfix.a infix.o</div>
</div><!-- fragment --><p><b>On Windows (MSVC):</b></p>
<div class="fragment"><div class="line"># 1. Compile the unity build source file</div>
<div class="line">cl /c /Iinclude src/infix.c /Foinfix.obj</div>
<div class="line"> </div>
<div class="line"># 2. Archive into a static library</div>
<div class="line">lib infix.obj /OUT:infix.lib</div>
</div><!-- fragment --><hr  />
<h2><a class="anchor" id="autotoc_md205"></a>
2. Integrating &lt;tt&gt;infix&lt;/tt&gt; into Your Project</h2>
<p>After building and installing <code>infix</code>, you can link it into your application.</p>
<h3><a class="anchor" id="autotoc_md206"></a>
Using CMake with &lt;tt&gt;find_package&lt;/tt&gt;</h3>
<p>If you installed <code>infix</code> to a standard location, you can use <code>find_package</code> in your project's <code>CMakeLists.txt</code>.</p>
<div class="fragment"><div class="line"># Your project&#39;s CMakeLists.txt</div>
<div class="line">cmake_minimum_required(VERSION 3.12)</div>
<div class="line">project(my_app C)</div>
<div class="line"> </div>
<div class="line"># Find the installed infix library and its dependencies.</div>
<div class="line"># If you installed to a custom path, add it to CMAKE_PREFIX_PATH.</div>
<div class="line"># e.g., cmake -DCMAKE_PREFIX_PATH=/path/to/your/install ..</div>
<div class="line">find_package(infix REQUIRED)</div>
<div class="line"> </div>
<div class="line">add_executable(my_app main.c)</div>
<div class="line"> </div>
<div class="line"># Link your application against the imported infix::infix target.</div>
<div class="line">target_link_libraries(my_app PRIVATE infix::infix)</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md207"></a>
Using pkg-config</h3>
<p>If you installed <code>infix</code>, a <code>infix.pc</code> file will be available for <code>pkg-config</code>. This is useful in Makefiles or for autotools-based projects.</p>
<p><b>Example Makefile:</b></p>
<div class="fragment"><div class="line">CFLAGS = -std=c17 `pkg-config --cflags infix`</div>
<div class="line">LIBS = `pkg-config --libs infix`</div>
<div class="line"> </div>
<div class="line">my_app: main.c</div>
<div class="line">    $(CC) $(CFLAGS) -o my_app main.c $(LIBS)</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md208"></a>
Using xmake</h3>
<p>Add <code>infix</code> as a dependency in your <code>xmake.lua</code>.</p>
<div class="fragment"><div class="line">-- Your project&#39;s xmake.lua</div>
<div class="line">set_project(&quot;my_awesome_app&quot;)</div>
<div class="line">set_version(&quot;1.0.0&quot;)</div>
<div class="line">set_languages(&quot;c17&quot;)</div>
<div class="line"> </div>
<div class="line">-- 1. Tell xmake where to find the infix project</div>
<div class="line">add_requires(&quot;infix&quot;, {git = &quot;https://github.com/sanko/infix.git&quot;})</div>
<div class="line"> </div>
<div class="line">-- Define your application&#39;s target</div>
<div class="line">target(&quot;my_awesome_app&quot;)</div>
<div class="line">    set_kind(&quot;binary&quot;)</div>
<div class="line">    add_files(&quot;src/*.c&quot;)</div>
<div class="line"> </div>
<div class="line">    -- 2. Link against the &quot;infix&quot; static library target</div>
<div class="line">    add_deps(&quot;infix&quot;)</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md209"></a>
Using in Visual Studio Code</h3>
<ol type="1">
<li>Place the <code>infix</code> source code in a subdirectory of your project (e.g., <code>libs/infix</code>).</li>
<li>Build the <code>infix</code> static library (e.g., using CMake).</li>
<li>Create a <code>.vscode</code> directory in your project root with the following files:</li>
</ol>
<p>**<code>c_cpp_properties.json</code>** (for IntelliSense)</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    &quot;configurations&quot;: [</div>
<div class="line">        {</div>
<div class="line">            &quot;name&quot;: &quot;Linux&quot;,</div>
<div class="line">            &quot;includePath&quot;: [</div>
<div class="line">                &quot;${workspaceFolder}/**&quot;,</div>
<div class="line">                &quot;${workspaceFolder}/libs/infix/include&quot; // &lt;-- Path to infix include dir</div>
<div class="line">            ],</div>
<div class="line">            &quot;cStandard&quot;: &quot;c17&quot;</div>
<div class="line">        }</div>
<div class="line">    ],</div>
<div class="line">    &quot;version&quot;: 4</div>
<div class="line">}</div>
</div><!-- fragment --><p>**<code>tasks.json</code>** (for Building)</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    &quot;version&quot;: &quot;2.0.0&quot;,</div>
<div class="line">    &quot;tasks&quot;: [</div>
<div class="line">        {</div>
<div class="line">            &quot;label&quot;: &quot;build with infix&quot;,</div>
<div class="line">            &quot;type&quot;: &quot;shell&quot;,</div>
<div class="line">            &quot;command&quot;: &quot;gcc&quot;,</div>
<div class="line">            &quot;args&quot;: [</div>
<div class="line">                &quot;-std=c17&quot;, &quot;-g&quot;, &quot;${file}&quot;,</div>
<div class="line">                &quot;-I${workspaceFolder}/libs/infix/include&quot;,   // Find infix headers</div>
<div class="line">                &quot;-L${workspaceFolder}/libs/infix/build/lib&quot;, // Find libinfix.a</div>
<div class="line">                &quot;-linfix&quot;,                                  // Link the library</div>
<div class="line">                &quot;-o&quot;, &quot;${fileDirname}/${fileBasenameNoExtension}&quot;</div>
<div class="line">            ],</div>
<div class="line">            &quot;group&quot;: { &quot;kind&quot;: &quot;build&quot;, &quot;isDefault&quot;: true }</div>
<div class="line">        }</div>
<div class="line">    ]</div>
<div class="line">}</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md210"></a>
Manual Integration into an Existing Project</h4>
<p>Because <code>infix</code> uses a "unity build," you do not need to build it as a separate static or shared library. You can compile it directly into your project. This is the simplest method and allows for better compiler optimizations.</p>
<ol type="1">
<li>Copy the <code>src/</code> and <code>include/</code> directories from the <code>infix</code> repository into your project's source tree (e.g., into a <code>third_party/infix</code> subdirectory).</li>
<li>Add the <code>infix</code> <code>include</code> path to your compiler's include search paths (e.g., <code>-Ithird_party/infix/include</code>).</li>
<li>Add the single <code><a class="el" href="infix_8c.html" title="The unity build source file for the infix library.">infix.c</a></code> file to your project's list of source files to be compiled.</li>
</ol>
<blockquote class="doxtable">
<p>&zwj;To integrate <code>infix</code> into your project, you only need to add <code><a class="el" href="infix_8c.html" title="The unity build source file for the infix library.">src/infix.c</a></code> to your list of source files to compile and add the <code>include/</code> directory to your include paths. </p>
</blockquote>
<p>That's it. Your project will now build with the <code>infix</code> library compiled directly in.</p>
<hr  />
<h2><a class="anchor" id="autotoc_md212"></a>
3. Packaging &lt;tt&gt;infix&lt;/tt&gt; (For Maintainers)</h2>
<h3><a class="anchor" id="autotoc_md213"></a>
Linux Distributions (DEB/RPM)</h3>
<p>The CMake install target is the standard way to integrate with packaging systems. The key is to use the <code>DESTDIR</code> environment variable during the install step.</p>
<p><b>Example for a Debian <code>rules</code> file:</b></p>
<div class="fragment"><div class="line"># debian/rules (simplified)</div>
<div class="line">override_dh_auto_configure:</div>
<div class="line">    dh_auto_configure -- -DCMAKE_INSTALL_PREFIX=/usr</div>
<div class="line"> </div>
<div class="line">override_dh_auto_build:</div>
<div class="line">    dh_auto_build</div>
<div class="line"> </div>
<div class="line">override_dh_auto_install:</div>
<div class="line">    dh_auto_install --destdir=$(CURDIR)/debian/tmp</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md214"></a>
xmake Repository</h3>
<p>To submit <code>infix</code> to the public <code>xmake-repo</code>, you would create a <code>packages/i/infix/xmake.lua</code> file in a fork of the repository.</p>
<div class="fragment"><div class="line">package(&quot;infix&quot;)</div>
<div class="line">    set_homepage(&quot;https://github.com/sanko/infix&quot;)</div>
<div class="line">    set_description(&quot;A JIT-powered FFI library for C&quot;)</div>
<div class="line"> </div>
<div class="line">    set_urls(&quot;https://github.com/sanko/infix/archive/refs/tags/v$(version).zip&quot;)</div>
<div class="line"> </div>
<div class="line">    add_versions(&quot;1.0.0&quot;, &quot;sha256_hash_of_the_zip_file&quot;)</div>
<div class="line"> </div>
<div class="line">    on_install(function (package)</div>
<div class="line">        os.cp(&quot;include&quot;, package:installdir())</div>
<div class="line">        local configs = {}</div>
<div class="line">        if package:config(&quot;shared&quot;) then</div>
<div class="line">            configs.kind = &quot;shared&quot;</div>
<div class="line">        end</div>
<div class="line">        import(&quot;package.tools.xmake&quot;).install(package, configs)</div>
<div class="line">    end)</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
