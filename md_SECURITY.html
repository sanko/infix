<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>infix: Security Policy</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript"> DoxygenAwesomeDarkModeToggle.init() </script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript"> DoxygenAwesomeFragmentCopyButton.init() </script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript"> DoxygenAwesomeParagraphLink.init() </script>
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript"> DoxygenAwesomeInteractiveToc.init() </script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">infix
   </div>
   <div id="projectbrief">A JIT-Powered FFI Library for C</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_SECURITY.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Security Policy</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md212"></a> This document outlines the security policy for <code>infix</code>.</p>
<p>The <code>infix</code> FFI library was designed with a security-first philosophy. Interfacing with C and generating executable code at runtime are inherently sensitive operations. This document outlines our threat model and the specific mitigations implemented to ensure the library is as safe and robust as possible.</p>
<h1><a class="anchor" id="autotoc_md213"></a>
Supported Versions</h1>
<p>Security updates are provided for the latest public release. As this is a pre-1.0 project, users are encouraged to stay on the most recent commit from the main development branch.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Version   </th><th class="markdownTableHeadNone">Supported    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">&gt;= 0.1.0   </td><td class="markdownTableBodyNone">:white_check_mark:    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">&lt; 0.1.0   </td><td class="markdownTableBodyNone">:x:    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">[unversioned]   </td><td class="markdownTableBodyNone">:white_check_mark:   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md214"></a>
Reporting a Vulnerability</h1>
<p>I take all security vulnerabilities seriously. To protect the project's users, I request that you report all suspected vulnerabilities to me privately.</p>
<p><b>Please do not report security vulnerabilities through public GitHub issues.</b></p>
<p>The preferred and most secure method for reporting is through <b><a href="https://github.com/sanko/infix/security/advisories/new">GitHub's private vulnerability reporting feature</a></b>. This creates a private advisory and opens a direct, secure line of communication.</p>
<p>If you are unable to use GitHub's reporting feature, you may send an email to <a href="#" onclick="location.href='mai'+'lto:'+'san'+'ko'+'@cp'+'an'+'.or'+'g'; return false;">sanko@cpan.org</a>.</p>
<p>Please include the following information in your report:</p>
<ul>
<li>A detailed description of the vulnerability and how to reproduce it.</li>
<li>The version(s) or commit hash of the library affected.</li>
<li>Any proof-of-concept code or steps that demonstrate the issue.</li>
<li>The potential impact of the vulnerability (e.g., code execution, information disclosure).</li>
</ul>
<p>I will do my best to acknowledge your report within 48 hours and will work with you to understand and resolve the issue. I will publicly credit you for your discovery once the vulnerability has been patched, unless you prefer to remain anonymous.</p>
<h1><a class="anchor" id="autotoc_md215"></a>
Security Model</h1>
<p>We consider the following to be the primary security threats for an FFI library:</p>
<ol type="1">
<li><b>Code Injection / JIT-Spraying</b>: An attacker providing malicious data that is inadvertently written into an executable memory region and later executed.</li>
<li><b>API Abuse &amp; Memory Corruption</b>: An attacker providing malformed type descriptions (e.g., with incorrect sizes or offsets) to the API, causing integer overflows that lead to buffer overflows or other memory corruption inside the library.</li>
<li><b>Use-After-Free Vulnerabilities</b>: An attacker causing the program to call a function pointer from a trampoline that has already been freed, potentially leading to arbitrary code execution.</li>
<li><b>Runtime State Corruption</b>: An attacker modifying the internal state of a callback (reverse trampoline) after its creation to hijack its behavior.</li>
</ol>
<h2><a class="anchor" id="autotoc_md216"></a>
Mitigations</h2>
<p><code>infix</code> employs several layers of defense to mitigate these threats.</p>
<h3><a class="anchor" id="autotoc_md217"></a>
1. W^X (Write XOR Execute) Memory Policy</h3>
<p><b>The most critical security feature of <code>infix</code> is its strict enforcement of a W^X memory policy.</b> Memory that is used for JIT-compiled trampolines is <b>never writable and executable at the same time</b>. This is a fundamental defense against code injection attacks.</p>
<p>This policy is implemented in <code><a class="el" href="executor_8c.html" title="Implements OS-level memory management and the internal callback dispatcher.">executor.c</a></code> using platform-specific, hardened techniques:</p>
<ul>
<li><b>On Hardened POSIX (Linux, FreeBSD)</b>: We use a <b>dual-mapping</b> technique. An anonymous shared memory object is created via <code>shm_open</code>. This object is then mapped into the process's virtual address space twice:<ul>
<li>One mapping is <code>PROT_READ | PROT_WRITE</code> (<code>rw_ptr</code>). Code is written here.</li>
<li>A second, separate mapping is <code>PROT_READ | PROT_EXEC</code> (<code>rx_ptr</code>). Code is executed from here. Because the virtual addresses are different, it is impossible for an attacker to write to the executable mapping.</li>
</ul>
</li>
<li><b>On Windows</b>: We use the native <code>VirtualAlloc</code> and <code>VirtualProtect</code> APIs. Memory is allocated as <code>PAGE_READWRITE</code>. After the machine code has been written, its protection is changed to <code>PAGE_EXECUTE_READ</code>, revoking write permissions before the code is ever used.</li>
<li><b>On macOS, OpenBSD, and others</b>: A reliable single-map <code>mmap</code> strategy is used. Memory is allocated as <code>PROT_READ | PROT_WRITE</code>. After code generation, <code>mprotect</code> is used to change the permissions to <code>PROT_READ | PROT_EXEC</code>.</li>
</ul>
<h3><a class="anchor" id="autotoc_md218"></a>
2. Use-After-Free Prevention (Guard Pages)</h3>
<p>When a trampoline is freed via <code>ffi_trampoline_free</code> or <code>ffi_reverse_trampoline_free</code>, the library does not simply release the memory.</p>
<p>First, the executable memory region's permissions are changed to be completely inaccessible (<code>PAGE_NOACCESS</code> on Windows, <code>PROT_NONE</code> on POSIX). This turns the region into a <b>guard page</b>. If any dangling function pointer attempts to call this freed code, the program will trigger an immediate and safe access violation (segmentation fault), rather than executing stale or unrelated data. This makes use-after-free bugs easy to detect and prevents them from being exploitable.</p>
<h3><a class="anchor" id="autotoc_md219"></a>
3. Read-Only Context Hardening</h3>
<p>The <code>ffi_reverse_trampoline_t</code> context struct holds critical information about a callback, including the pointer to the user's handler function. To prevent an attacker from modifying this context at runtime, the entire structure is placed in a protected memory region.</p>
<p>After <code>generate_reverse_trampoline</code> successfully initializes the context, the memory page it resides on is made <b>read-only</b> using <code>VirtualProtect</code> or <code>mprotect</code>. Any subsequent attempt to write to this structure will result in a safe crash, preventing callback hijacking.</p>
<h3><a class="anchor" id="autotoc_md220"></a>
4. API Hardening Against Integer Overflows</h3>
<p>The type creation API (<code><a class="el" href="types_8c.html" title="Implements the public API for creating and managing type descriptions.">types.c</a></code>) is a potential attack surface. An attacker could provide malicious <code>size</code>, <code>offset</code>, or <code>num_elements</code> values to functions like <code>ffi_type_create_struct</code> and <code>ffi_type_create_array</code> in an attempt to trigger an integer overflow during layout calculations.</p>
<p>All such calculations in the <code>infix</code> library are hardened with checks against <code>SIZE_MAX</code> to prevent wrap-around. If a potential overflow is detected, the function will immediately fail with <code>INFIX_ERROR_INVALID_ARGUMENT</code>, preventing the creation of a malformed <code>ffi_type</code> that could lead to memory corruption in later stages.</p>
<h3><a class="anchor" id="autotoc_md221"></a>
5. Continuous Security Validation (Fuzzing)</h3>
<p>The library is continuously tested using modern fuzzing tools (libFuzzer and AFL++). The fuzzing harnesses in the <code>fuzz/</code> directory are designed to attack the most complex parts of the library:</p>
<ul>
<li>**<code>fuzz_types</code>**: Attacks the type creation and destruction logic with deeply-nested, randomized, and invalid type definitions.</li>
<li>**<code>fuzz_trampoline</code>**: Attacks the ABI classification and code generation pipeline with randomized function signatures.</li>
</ul>
<p>This ensures that our security mitigations are constantly validated against unexpected and malicious inputs. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
